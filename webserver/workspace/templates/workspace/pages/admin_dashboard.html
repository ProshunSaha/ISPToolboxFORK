{% extends "admin/base_site.html" %}
{% load i18n %}
{% load static %}

{% block content %}
<script src="https://code.highcharts.com/highcharts.js"></script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
  <h1>{%blocktranslate%} ISP Toolbox Workspace Dashboard{% endblocktranslate%}</h1>
  <p>{%blocktranslate%}Let's see how we're doing{% endblocktranslate%}</p>
  <div class="mb-5" style="
    display: grid;
    gap: 1rem;
    grid-template-columns: repeat(auto-fit, minmax(12rem, 1fr));"
 >
  <div class="card" style="">
    <div class="card-body">
      <h5 class="card-title">{{ stats.user_count }} user{{ stats.user_count|pluralize }}</h5>
      <h6 class="card-subtitle mb-2 text-muted">Total Users: All-time</h6>
    </div>
  </div>
  <div class="card" style="">
    <div class="card-body">
      <h5 class="card-title">{{ stats.todays_users }} user{{ stats.todays_users|pluralize }}</h5>
      <h6 class="card-subtitle mb-2 text-muted">Daily Active Users: Today</h6>
    </div>
  </div>
  <div class="card" style="">
    <div class="card-body">
      <h5 class="card-title">{{ stats.todays_sessions }} session{{ stats.todays_sessions|pluralize }}</h5>
      <h6 class="card-subtitle mb-2 text-muted">Anonymous Sessions: Today</h6>
    </div>
  </div>
  </div>
  <div id="chart" style="width:100%; height:400px;"></div>
  {{ stats.tool_breakdown|json_script:"tool-breakdown" }}
  <script>
  Highcharts.theme = {% include "workspace/atoms/highcharts-style.html" %}
  Highcharts.setOptions(Highcharts.theme);
  const chart_data = JSON.parse(document.getElementById('tool-breakdown').textContent);
  document.addEventListener('DOMContentLoaded', function () {
    const chart = Highcharts.chart('chart', {
        chart: {
            type: 'area'
        },
        title: {
            text: 'ISP Toolbox Workspace Usage - Last 90 Days'
        },
        xAxis: {
            type: 'datetime'
        },
        yAxis: {
            title: {
                text: 'Breakdown by Tool'
            }
        },
        plotOptions: {
            series: {
                stacking: 'normal'
            }
        },
        series: Object.keys(chart_data).map((k) => {
    
            return { type: 'area',name: k,
            data: chart_data[k]}}
      )
    });
});
</script>
  {{block.super}}
{% endblock content%}