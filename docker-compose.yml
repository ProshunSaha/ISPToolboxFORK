version: '3'

services:
    django_webserver:
        image: isptoolbox-django
        build: ./webserver
        volumes:
            - ./webserver:/usr/src/app
        ports:
            - 80:80
    nginx:
        image: isptoolbox-nginx
        build: ./nginx
        network_mode: 'service:django_webserver'
        depends_on:
            - django_webserver
    celery:
        image: isptoolbox-celery
        build: ./webserver
        command: celery -A webserver worker -l info
        volumes:
            - ./webserver/:/usr/src/app/
        environment:
            - DJANGO_SETTINGS_MODULE=webserver.settings_prod